---
title: "Deployment URL Hygiene"
---

Keep your URLs correct across dev, preview, and production so canonicals, sitemaps, and social tags never leak `localhost`. Uses npm, Node 20.15.0+, and the Baseline setup from earlier tutorials.

## What you’ll build
- A Baseline site that reads the right origin for each environment.
- Canonical, sitemap, and social URLs pointed at the expected domain (or preview).

## Prerequisites
- Baseline installed and loaded.
- `package.json` with `"type": "module"` and scripts:
  ```json
  {
    "type": "module",
    "scripts": {
      "dev": "npx @11ty/eleventy --serve",
      "build": "npx @11ty/eleventy"
    }
  }
  ```

## 1) Set site.url (and optionally pathPrefix)
In `src/_data/site.js`:
```js
export default {
  title: "Baseline Deployment Hygiene",
  tagline: "Correct URLs across dev/preview/prod",
  url: process.env.URL || "http://localhost:8080", // override per env
  defaultLanguage: "en",
  noindex: false
};
```
- Use `pathPrefix` in `eleventy.config.js` if deploying under a subpath (e.g., `/my-site/`). Baseline head/sitemap will respect it.

## 2) Env vars to support (use a local .env)
- Create a local `.env` for dev/preview builds:
  ```
  URL=http://localhost:8080
  ```
- For production, set `URL` to your live origin (and commit only the reference, not secrets):
  ```
  URL=https://example.com
  ```
- `DEPLOY_URL`, `DEPLOY_PRIME_URL`: common on Netlify for preview URLs; Baseline will use these if `URL` is not set.
- Baseline loads `dotenv`, so `process.env.URL` is available in Eleventy and your `site.js`.

## 3) Local dev vs production
- Dev: use your local `.env` (e.g., `URL=http://localhost:8080`) and run:
  ```bash
  npm run dev
  ```
- Production build: set `URL` in your hosting/CI environment (don’t rely on inline shell overrides) so builds always have the correct origin. Then run:
  ```bash
  npm run build
  ```

## 4) Preview builds
- On Netlify, `DEPLOY_URL` / `DEPLOY_PRIME_URL` provide the preview origin; `URL` is also set to the live site for production. Other hosts differ — set an equivalent preview URL env var for staging.
- Verify the rendered canonical and sitemap root match the preview domain.

## 5) Verify outputs
- View source: check `<link rel="canonical">` and OG/Twitter URLs — no `localhost` when `URL` is set.
- Inspect `dist/sitemap.xml` (and per-language sitemaps if multilingual): URLs should start with the expected origin (plus `pathPrefix` if used).

## 6) PathPrefix checklist (if applicable)
- In `eleventy.config.js`, set `pathPrefix` to your subpath (e.g., `/docs/`).
- Ensure assets/links/canonicals/sitemaps use the prefixed paths; rebuild and verify.

## 7) Next steps
- Pair with the social previews tutorial to ensure social images use absolute URLs.
- Add a CI check that fails builds if `URL` is missing for production.

